'use strict'

angular.module('appApp.controllers', ['appApp.services'])
  .controller('MainCtrl', ['$scope', 'ApiGet', ($scope, ApiGet) ->
    $scope.awesomeThings = ['HTML5 Boilerplate', 'AngularJS', 'Karma']
    $scope.reps = {}
    $scope.reps_names_list = []

    $scope.get_all_reps_in_office = ()->
      ApiGet.congress "/legislators?per_page_all", $scope.callback_all_reps_in_office, this

    $scope.callback_all_reps_in_office = (error, data) ->
      if not error
        for rep in data
          rep.fullname = "#{rep.title}. #{rep.first_name} #{rep.last_name}"
          $scope.reps_names_list.push({name: rep.fullname})
      else
        console.log "Error: ", error
   
    $scope.get_all_reps_in_office()
    
  ])
  .controller('BillCtrl', ['$scope', '$http', ($scope, $http) ->
    $scope.bill = {last_version: urls: {xml: 'http://www.gpo.gov/fdsys/pkg/BILLS-113hres334ih/xml/BILLS-113hres334ih.xml'}}
    $scope.bills = [{"bill_id":"hres334-113","bill_type":"hres","chamber":"house","committee_ids":["HSGO"],"congress":113,"cosponsors_count":23,"enacted_as":null,"history":{"active":false,"awaiting_signature":false,"enacted":false,"vetoed":false},"introduced_on":"2013-08-02","last_action_at":"2013-08-02","last_version":{"version_code":"ih","issued_on":"2013-08-02","version_name":"Introduced in House","bill_version_id":"hres334-113-ih","urls":{"html":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres334ih/html/BILLS-113hres334ih.htm","pdf":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres334ih/pdf/BILLS-113hres334ih.pdf","xml":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres334ih/xml/BILLS-113hres334ih.xml"},"pages":3},"last_version_on":"2013-08-02","last_vote_at":null,"number":334,"official_title":"Condemning the attack that occurred at the Oak Creek Sikh Gurdwara on August 5, 2012, and honoring the memory of those who died in the attack.","popular_title":null,"related_bill_ids":[],"short_title":null,"sponsor_id":"V000129","urls":{"congress":"http://beta.congress.gov/bill/113th/house-resolution/334","govtrack":"http://www.govtrack.us/congress/bills/113/hres334","opencongress":"http://www.opencongress.org/bill/113-hr334/show"},"withdrawn_cosponsors_count":0},{"bill_id":"hres333-113","bill_type":"hres","chamber":"house","committee_ids":["HSAP","HSWM"],"congress":113,"cosponsors_count":0,"enacted_as":null,"history":{"active":false,"awaiting_signature":false,"enacted":false,"vetoed":false},"introduced_on":"2013-08-02","last_action_at":"2013-08-02","last_version":{"version_code":"ih","issued_on":"2013-08-02","version_name":"Introduced in House","bill_version_id":"hres333-113-ih","urls":{"html":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres333ih/html/BILLS-113hres333ih.htm","pdf":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres333ih/pdf/BILLS-113hres333ih.pdf","xml":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres333ih/xml/BILLS-113hres333ih.xml"},"pages":6},"last_version_on":"2013-08-02","last_vote_at":null,"number":333,"official_title":"Expressing the firm conviction of the House of Representatives that any continuing resolution or debt ceiling increase it may approve for the duration of the 113th Congress shall affirmatively include a provision specifically prohibiting the expenditure of any federal funds in support of or in implementation or effectuation or enforcement of any provision of the Affordable Care Act (\"ObamaCare\").","popular_title":null,"related_bill_ids":[],"short_title":null,"sponsor_id":"S000937","urls":{"congress":"http://beta.congress.gov/bill/113th/house-resolution/333","govtrack":"http://www.govtrack.us/congress/bills/113/hres333","opencongress":"http://www.opencongress.org/bill/113-hr333/show"},"withdrawn_cosponsors_count":0},{"bill_id":"hres332-113","bill_type":"hres","chamber":"house","committee_ids":["HSAG"],"congress":113,"cosponsors_count":6,"enacted_as":null,"history":{"active":false,"awaiting_signature":false,"enacted":false,"vetoed":false},"introduced_on":"2013-08-02","last_action_at":"2013-08-02","last_version":{"version_code":"ih","issued_on":"2013-08-02","version_name":"Introduced in House","bill_version_id":"hres332-113-ih","urls":{"html":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres332ih/html/BILLS-113hres332ih.htm","pdf":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres332ih/pdf/BILLS-113hres332ih.pdf","xml":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres332ih/xml/BILLS-113hres332ih.xml"},"pages":2},"last_version_on":"2013-08-02","last_vote_at":null,"number":332,"official_title":"Recognizing the 200th anniversary of the Howard Flats Farm in Hornell, New York.","popular_title":null,"related_bill_ids":[],"short_title":null,"sponsor_id":"R000585","urls":{"congress":"http://beta.congress.gov/bill/113th/house-resolution/332","govtrack":"http://www.govtrack.us/congress/bills/113/hres332","opencongress":"http://www.opencongress.org/bill/113-hr332/show"},"withdrawn_cosponsors_count":0},{"bill_id":"hres331-113","bill_type":"hres","chamber":"house","committee_ids":["HSED"],"congress":113,"cosponsors_count":17,"enacted_as":null,"history":{"active":false,"awaiting_signature":false,"enacted":false,"vetoed":false},"introduced_on":"2013-08-02","last_action_at":"2013-08-02","last_version":{"version_code":"ih","issued_on":"2013-08-02","version_name":"Introduced in House","bill_version_id":"hres331-113-ih","urls":{"html":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres331ih/html/BILLS-113hres331ih.htm","pdf":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres331ih/pdf/BILLS-113hres331ih.pdf","xml":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres331ih/xml/BILLS-113hres331ih.xml"},"pages":4},"last_version_on":"2013-08-02","last_vote_at":null,"number":331,"official_title":"Expressing support for designation of September 18 as \"National Innovation in Education Day\".","popular_title":null,"related_bill_ids":[],"short_title":null,"sponsor_id":"P000608","urls":{"congress":"http://beta.congress.gov/bill/113th/house-resolution/331","govtrack":"http://www.govtrack.us/congress/bills/113/hres331","opencongress":"http://www.opencongress.org/bill/113-hr331/show"},"withdrawn_cosponsors_count":0},{"bill_id":"hres330-113","bill_type":"hres","chamber":"house","committee_ids":["HSRU"],"congress":113,"cosponsors_count":14,"enacted_as":null,"history":{"active":false,"awaiting_signature":false,"enacted":false,"vetoed":false},"introduced_on":"2013-08-02","last_action_at":"2013-08-02","last_version":{"version_code":"ih","issued_on":"2013-08-02","version_name":"Introduced in House","bill_version_id":"hres330-113-ih","urls":{"html":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres330ih/html/BILLS-113hres330ih.htm","pdf":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres330ih/pdf/BILLS-113hres330ih.pdf","xml":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres330ih/xml/BILLS-113hres330ih.xml"},"pages":3},"last_version_on":"2013-08-02","last_vote_at":null,"number":330,"official_title":"Expressing the sense of the House of Representatives that until the United States southern border is secured as confirmed by the governors and the legislatures jointly of the four southern border states, the House of Representatives shall not bring any legislation including any conference report regarding immigration to the floor of the House for a vote.","popular_title":null,"related_bill_ids":[],"short_title":null,"sponsor_id":"G000552","urls":{"congress":"http://beta.congress.gov/bill/113th/house-resolution/330","govtrack":"http://www.govtrack.us/congress/bills/113/hres330","opencongress":"http://www.opencongress.org/bill/113-hr330/show"},"withdrawn_cosponsors_count":0},{"bill_id":"hres329-113","bill_type":"hres","chamber":"house","committee_ids":["HSFA"],"congress":113,"cosponsors_count":3,"enacted_as":null,"history":{"active":false,"awaiting_signature":false,"enacted":false,"vetoed":false},"introduced_on":"2013-08-02","last_action_at":"2013-08-02","last_version":{"version_code":"ih","issued_on":"2013-08-02","version_name":"Introduced in House","bill_version_id":"hres329-113-ih","urls":{"html":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres329ih/html/BILLS-113hres329ih.htm","pdf":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres329ih/pdf/BILLS-113hres329ih.pdf","xml":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres329ih/xml/BILLS-113hres329ih.xml"},"pages":4},"last_version_on":"2013-08-02","last_vote_at":null,"number":329,"official_title":"Calling for the support of the fundamental rights of all Egyptian citizens, equal access to justice and due process of law, and transparent and accountable governance in Egypt.","popular_title":null,"related_bill_ids":[],"short_title":null,"sponsor_id":"F000448","urls":{"congress":"http://beta.congress.gov/bill/113th/house-resolution/329","govtrack":"http://www.govtrack.us/congress/bills/113/hres329","opencongress":"http://www.opencongress.org/bill/113-hr329/show"},"withdrawn_cosponsors_count":0},{"bill_id":"hres328-113","bill_type":"hres","chamber":"house","committee_ids":["HSJU"],"congress":113,"cosponsors_count":50,"enacted_as":null,"history":{"active":false,"awaiting_signature":false,"enacted":false,"vetoed":false},"introduced_on":"2013-08-02","last_action_at":"2013-08-02","last_version":{"version_code":"ih","issued_on":"2013-08-02","version_name":"Introduced in House","bill_version_id":"hres328-113-ih","urls":{"html":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres328ih/html/BILLS-113hres328ih.htm","pdf":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres328ih/pdf/BILLS-113hres328ih.pdf","xml":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres328ih/xml/BILLS-113hres328ih.xml"},"pages":4},"last_version_on":"2013-08-02","last_vote_at":null,"number":328,"official_title":"Condemning the discrimination, hate crimes, racism, bigotry, bullying, and brutal violence perpetrated against Sikh-Americans, and all acts of vandalism against Sikh Gurdwaras in the United States, and remembering the tragedy that occurred at the Sikh Gurdwara of Wisconsin one year ago.","popular_title":null,"related_bill_ids":[],"short_title":null,"sponsor_id":"C001038","urls":{"congress":"http://beta.congress.gov/bill/113th/house-resolution/328","govtrack":"http://www.govtrack.us/congress/bills/113/hres328","opencongress":"http://www.opencongress.org/bill/113-hr328/show"},"withdrawn_cosponsors_count":0},{"bill_id":"hres327-113","bill_type":"hres","chamber":"house","committee_ids":["HSFA"],"congress":113,"cosponsors_count":0,"enacted_as":null,"history":{"active":false,"awaiting_signature":false,"enacted":false,"vetoed":false},"introduced_on":"2013-08-02","last_action_at":"2013-08-02","last_version":{"version_code":"ih","issued_on":"2013-08-02","version_name":"Introduced in House","bill_version_id":"hres327-113-ih","urls":{"html":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres327ih/html/BILLS-113hres327ih.htm","pdf":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres327ih/pdf/BILLS-113hres327ih.pdf","xml":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres327ih/xml/BILLS-113hres327ih.xml"},"pages":9},"last_version_on":"2013-08-02","last_vote_at":null,"number":327,"official_title":"Expressing the sense of the House of Representatives regarding China's membership in the United Nations Human Rights Council (UNHRC).","popular_title":null,"related_bill_ids":[],"short_title":null,"sponsor_id":"B001280","urls":{"congress":"http://beta.congress.gov/bill/113th/house-resolution/327","govtrack":"http://www.govtrack.us/congress/bills/113/hres327","opencongress":"http://www.opencongress.org/bill/113-hr327/show"},"withdrawn_cosponsors_count":0},{"bill_id":"hres326-113","bill_type":"hres","chamber":"house","committee_ids":["HSJU"],"congress":113,"cosponsors_count":0,"enacted_as":null,"history":{"active":false,"awaiting_signature":false,"enacted":false,"vetoed":false},"introduced_on":"2013-08-02","last_action_at":"2013-08-02","last_version":{"version_code":"ih","issued_on":"2013-08-02","version_name":"Introduced in House","bill_version_id":"hres326-113-ih","urls":{"html":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres326ih/html/BILLS-113hres326ih.htm","pdf":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres326ih/pdf/BILLS-113hres326ih.pdf","xml":"http://www.gpo.gov/fdsys/pkg/BILLS-113hres326ih/xml/BILLS-113hres326ih.xml"},"pages":3},"last_version_on":"2013-08-02","last_vote_at":null,"number":326,"official_title":"Expressing the sense of the House of Representatives that any immigration reform proposal adopted by Congress should not legalize, grant amnesty for, or confer any other legal status condoning the otherwise unlawful entry or presence in the United States of any individual.","popular_title":null,"related_bill_ids":[],"short_title":null,"sponsor_id":"B001262","urls":{"congress":"http://beta.congress.gov/bill/113th/house-resolution/326","govtrack":"http://www.govtrack.us/congress/bills/113/hres326","opencongress":"http://www.opencongress.org/bill/113-hr326/show"},"withdrawn_cosponsors_count":0},{"bill_id":"hr3063-113","bill_type":"hr","chamber":"house","committee_ids":["HSII"],"congress":113,"cosponsors_count":0,"enacted_as":null,"history":{"active":false,"awaiting_signature":false,"enacted":false,"vetoed":false},"introduced_on":"2013-08-02","last_action_at":"2013-08-02","last_version":{"version_code":"ih","issued_on":"2013-08-02","version_name":"Introduced in House","bill_version_id":"hr3063-113-ih","urls":{"html":"http://www.gpo.gov/fdsys/pkg/BILLS-113hr3063ih/html/BILLS-113hr3063ih.htm","pdf":"http://www.gpo.gov/fdsys/pkg/BILLS-113hr3063ih/pdf/BILLS-113hr3063ih.pdf","xml":"http://www.gpo.gov/fdsys/pkg/BILLS-113hr3063ih/xml/BILLS-113hr3063ih.xml"},"pages":9},"last_version_on":"2013-08-02","last_vote_at":null,"number":3063,"official_title":"To amend the Magnuson-Stevens Fishery Conservation and Management Act to require the Secretary of Commerce to develop a plan to conduct stock assessments for all stocks of fish for which a fishery management plan is in effect under that Act, and for other purposes.","popular_title":null,"related_bill_ids":[],"short_title":"Healthy Fisheries through Better Science Act","sponsor_id":"W000804","urls":{"congress":"http://beta.congress.gov/bill/113th/house-bill/3063","govtrack":"http://www.govtrack.us/congress/bills/113/hr3063","opencongress":"http://www.opencongress.org/bill/113-h3063/show"},"withdrawn_cosponsors_count":0}]
    $scope.$watch "bill", ->
      getBillText $scope.bill.last_version.urls.xml

    getBillList = ->
      $http(
        method: "JSON"
        url: "http://congress.api.sunlightfoundation.com/bills?apikey=3cdfa27b289e4d4090fd1b176c45e6cf&per_page=10&page=1"
      ).success((data, status) ->
        $scope.bills = data.results
      ).error (data, status) ->
        console.log "Error #{status}: #{data}"

    getBillText = (url) ->
      $http(
        method: "XML"
        url: url
      ).success((data, status) ->
        $scope.bill.text = data
      ).error (data, status) ->
        console.log "Error #{status}: #{data}"
  ])
